<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="utf-8" />
		<title>稀土大数据</title>
		<link rel="stylesheet" th:href="@{/css/xinit.css}" />
		<link rel="stylesheet" th:href="@{/css/xswiper.min.css}" />
		<link rel="stylesheet" th:href="@{/css/xmain.css}" />
		<script type="text/javascript" th:src="@{/js/jquery-1.7.2.js}" ></script>
		<script type="text/javascript" th:src="@{/js/jquery.cookie.js}" ></script>
		<script type="text/javascript" th:src="@{/js/swiper.min.js}" ></script>
		
	</head>
	<body class="indexBody">
		<div class="indexbanner">
		<div class="index-container">
		<div class="head">
			<div class="clearfix">
				<a href="/" class="left logo">
					<img th:src="@{/ximages/logo.png}" />
				</a>
				<div class="left menu clearfix">
					<a href="/">平台首页</a>
					<a id="xituzhiku" href="#">稀土智库</a>
					<a id="cailiaojisuan" href="#">材料计算</a>
					<a id="chanyejiance" href="#">产业监测</a>
					<a id="zhishifuwu" href="#">情报服务</a>
					<a th:href="@{/hezuo/jiaoliu}">合作交流</a>
					<a th:href="@{/guanyu/women}">关于我们</a>
				</div>
				<div th:replace="qiantaidenglu :: myqiantaidenglu"></div>
			</div>
		</div>
		<!-- <div class="logoText">
			稀土大数据平台
		</div>
		<div class="indexTopSmall">
			整合稀土领域各类科技信息资源，为稀土行业提供定制化知识服务
		</div> -->
		<!-- <div class="clearfix">
			<div class="headSS left clearfix">
				<input type="text" class="left headSSLf" placeholder="请输入稀土相关的关键词" id="keywords"/>
				<input type="button" class="left headSSRt" value="搜索" id="search" onClick="search();"/>
				
			</div>
			<div class="right clearfix" style="width:240px">
				<input type="button" class="left headSSRt" value="文献入口" id="search" onClick="papersearch();"/>
				<input type="button" class="right headSSRt" value="专利入口" id="search" onClick="search();"/>
			</div>
		</div> -->
		<div class="clearfix">
		<div class="left rare-earth-lf">
			<a href="#" class="ahover">
				全部
			</a>
			<a href="javascript:search()">
				专利入口
			</a>
			<a href="javascript:papersearch()">
				文献入口
			</a>
		</div>
		<div class="rare-earth-rt">
        <div class="logoText">
			稀土大数据
		</div>
		<div class="indexTopSmall">
			整合稀土领域各类科技信息资源，为稀土行业提供定制化知识服务
		</div>
		<div class="clearfix">
			<div class="headSS left clearfix">
				<input type="text" class="left headSSLf" placeholder="请输入稀土相关的关键词" id="keywords">
				<input type="button" class="left headSSRt" value="搜索" id="search" onclick="search();">
				
			</div>
			
		</div>
		</div>
		</div>
		<div class="headCompanyTl">
			<span>
				元素导航
			</span>
		</div>
		<div class="clearfix yuansu">
		<a id="la" th:href="@{/yuansu/xiangqing?name=镧}">
				<p class="yuansuTop">
					57
				</p>
				<p class="yuansuM">
					镧
				</p>
				<p class="yuansuB">
					La
				</p>
			</a>
			<a id="ce" th:href="@{/yuansu/xiangqing?name=铈}">
				<p class="yuansuTop">
					58
				</p>
				<p class="yuansuM">
					铈
				</p>
				<p class="yuansuB">
					Ce
				</p>
			</a>
			<a id="pr" th:href="@{/yuansu/xiangqing?name=镨}">
				<p class="yuansuTop">
					59
				</p>
				<p class="yuansuM">
					镨
				</p>
				<p class="yuansuB">
					Pr
				</p>
			</a>
			<a id="nd" th:href="@{/yuansu/xiangqing?name=钕}">
				<p class="yuansuTop">
					60
				</p>
				<p class="yuansuM">
					钕
				</p>
				<p class="yuansuB">
					Nd
				</p>
			</a>
			<a id="pm" th:href="@{/yuansu/xiangqing?name=钷}">
				<p class="yuansuTop">
					61
				</p>
				<p class="yuansuM">
					钷
				</p>
				<p class="yuansuB">
					Pm
				</p>
			</a>
			<a id="sm" th:href="@{/yuansu/xiangqing?name=钐}">
				<p class="yuansuTop">
					62
				</p>
				<p class="yuansuM">
					钐
				</p>
				<p class="yuansuB">
					Sm
				</p>
			</a>
			<a id="eu" th:href="@{/yuansu/xiangqing?name=铕}">
				<p class="yuansuTop">
					63
				</p>
				<p class="yuansuM">
					铕
				</p>
				<p class="yuansuB">
					Eu
				</p>
			</a>
			<a id="gd" th:href="@{/yuansu/xiangqing?name=钆}">
				<p class="yuansuTop">
					64
				</p>
				<p class="yuansuM">
					钆
				</p>
				<p class="yuansuB">
					Gd
				</p>
			</a>
			<a id="tb" th:href="@{/yuansu/xiangqing?name=铽}">
				<p class="yuansuTop">
					65
				</p>
				<p class="yuansuM">
					铽
				</p>
				<p class="yuansuB">
					Tb
				</p>
			</a>
			<a id="dy" th:href="@{/yuansu/xiangqing?name=镝}">
				<p class="yuansuTop">
					66
				</p>
				<p class="yuansuM">
					镝
				</p>
				<p class="yuansuB">
					Dy
				</p>
			</a>
			<a id="ho" th:href="@{/yuansu/xiangqing?name=钬}">
				<p class="yuansuTop">
					67
				</p>
				<p class="yuansuM">
					钬
				</p>
				<p class="yuansuB">
					Ho
				</p>
			</a>
			<a id="er" th:href="@{/yuansu/xiangqing?name=铒}">
				<p class="yuansuTop">
					68
				</p>
				<p class="yuansuM">
					铒
				</p>
				<p class="yuansuB">
					Er
				</p>
			</a>
			<a id="tm" th:href="@{/yuansu/xiangqing?name=铥}">
				<p class="yuansuTop">
					69
				</p>
				<p class="yuansuM">
					铥
				</p>
				<p class="yuansuB">
					Tm
				</p>
			</a>
			<a id="yb" th:href="@{/yuansu/xiangqing?name=镱}">
				<p class="yuansuTop">
					70
				</p>
				<p class="yuansuM">
					镱
				</p>
				<p class="yuansuB">
					Yb
				</p>
			</a>
			<a id="lu" th:href="@{/yuansu/xiangqing?name=镥}">
				<p class="yuansuTop">
					71
				</p>
				<p class="yuansuM">
					镥
				</p>
				<p class="yuansuB">
					Lu
				</p>
			</a>
			<a id="sc" th:href="@{/yuansu/xiangqing?name=钪}">
				<p class="yuansuTop">
					21
				</p>
				<p class="yuansuM">
					钪
				</p>
				<p class="yuansuB">
					Sc
				</p>
			</a>
			<a id="y" th:href="@{/yuansu/xiangqing?name=钇}">
				<p class="yuansuTop">
					39
				</p>
				<p class="yuansuM">
					钇
				</p>
				<p class="yuansuB">
					Y
				</p>
			</a>
		</div>
		<div class="headCompanyTl" style="margin-top: 0px;">
			<span>
				功能导航
			</span>
		</div>
		</div>
		<div class="gongneng">
			<div class="index-container clearfix">
				<a id="xituzhiku11" href="#" class="left">
					<img th:src="@{/ximages/gongneg4.png}" />
					稀土智库
				</a>
				<a id="zhishifuwu11" href="#" class="left">
					<img th:src="@{/ximages/gongneng3.png}" />
					情报服务
				</a>
				<a id="cailiaojisuan11" href="#" class="left">
					<img th:src="@{/ximages/gongneng1.png}" />
					材料计算
				</a>
				<a id="chanyejiance11" href="#" class="left">
					<img th:src="@{/ximages/gongneng2.png}" />
					产业监测
				</a>
			</div>
		</div>
		</div>
	    
		<div th:replace="footer :: myfooter"></div>
	   <!--弹窗-->
	    <div class="alertBg"></div>
	    <!--登录二维码弹窗-->
	    <div class="alertCon alertErw" id="showcode">
	    	<img id="showqrcode" th:src="@{/ximages/jiazai.png}" />
	    	<p class="alertErwText">
	    		<span>微信</span>扫描直接注册登陆
	    	</p>
	    	<p class="alertErwA">
	    		<a href="javascript:;" class="alertZHbtn">
	    			用户名密码登录
	    		</a>
	    	</p>
	    </div>
	 <!--   账号登录-->
	    <div class="alertCon alertZh">
	    	<div class="alertTl">
	    		账户登录
	    	</div>
	    	<div class="alertForm">
	    		<form name="loginForm" action="/user/login" method="POST" enctype="multipart/form-data">
	    			<div class="alertFormGp erro">
	    			<label for="" class="alertFormName">
	    				用户名<span>*</span>
	    			</label>
	    			<input type="text" class="alertInp" placeholder="请输入用户名" name="account" id="lnaccount"/>
<!-- 	    			<div class="erroText">
	    				输入错误
	    			</div>
	    			<div class="erroText" id="noaccount">
	    				用户名不存在
	    			</div> -->
	    			</div>
	    			<div class="alertFormGp">
	    			<label for="" class="alertFormName">
	    				密码<span>*</span>
	    			</label>
	    			<input type="password" class="alertInp" placeholder="请输入密码" name="password" id="lnpassword"/>
<!-- 	    			<div class="erroText" id="passworderror">
	    				密码错误
	    			</div> -->
	    			</div>
	    			<!-- <div class="alertFormGp">
	    			<label for="" class="alertFormName">
	    				验证码<span>*</span>
	    			</label>
	    			<div class="clearfix alertYzm">
	    			<input type="text" class="alertInp left" placeholder="请输入验证码" id="yzm"/>
	    			<input type="hidden" class="alertInp left" placeholder="请输入验证码" id="hiddentoken" name="token"/>
	    			<a href="#" class="right alertYzmImg">
	    				<img th:src="@{/images/yzm.jpg}" />
	    			</a>
	    			</div>
	    			<div class="erroText">
	    				输入错误
	    			</div>
	    			</div> -->
	    		    <input type="button" value="登录" class="alertSubmit" id="loginButtion"/>
	    		    <div class="alertReg">
	    		    	<a href="javascript:;">第一次使用？点击注册>></a>
	    		    </div>
	    		</form>
	    	</div>
	    </div>
	    <!--绑定账号-->
	    <div class="alertCon alertbd" id="alertbd">
	    	<div class="alertTl">
	    		信息绑定
	    	</div>
	    	<div class="alertForm">
	    		<form id="bindForm">
	    			<div class="alertFormGp">
	    			<label for="" class="alertFormName">
	    				用户名<span>*</span>
	    			</label>
	    			<input type="text" class="alertInp" placeholder="请输入用户名" id="bdaccount" name="account"/>
	    			<div class="erroText" id="exist">
	    				用户名已被绑定
	    			</div>
	    			<div class="erroText">
	    				输入错误
	    			</div>
	    			</div>
	    			<div class="alertFormGp">
	    			<label for="" class="alertFormName">
	    				密码<span>*</span>
	    			</label>
	    			<input type="password" class="alertInp" placeholder="请输入密码" id="bdpassword" name="password"/>
	    			<div class="erroText">
	    				输入错误
	    			</div>
	    			</div>
	    			<div class="alertFormGp">
	    			<label for="" class="alertFormName">
	    				确认密码<span>*</span>
	    			</label>
	    			<input type="password" class="alertInp" placeholder="请确认密码" id="bdpassword2" name="password2"/>
	    			<div class="erroText">
	    				输入错误
	    			</div>
	    			</div>
	    			<div class="alertFormGp">
	    			<label for="" class="alertFormName">
	    				邮箱<span>*</span>
	    			</label>
	    			<input type="password" class="alertInp" placeholder="请输入邮箱地址" id="bdemail" name="email"/>
	    			<div class="erroText">
	    				输入错误
	    			</div>
	    			</div>
	    		    <div class="clearfix">
	    		    	<input type="button" class="right alertbdSub" value="确认" id="bindButtion"/>
	    		    </div>
	    		</form>
	    	</div>
	    </div>
	    <script type="text/javascript" th:src="@{/js/main.js}" ></script>
	    <script type="text/javascript" th:src="@{/js/common.js}" ></script>
	    <script type="text/javascript">
	    	/* var token =  [[${token}]];
	    	var account =  [[${account}]];
	    	var role =  [[${role}]]; */
	    	
	    	var time;
	    	// 获取登录二维码
	        function getQcode() {
	            var url = "/wechat/getLoginQcode";
	            $.ajax({
	                url: url,
	                type: "get",
	                async: true,
	                success: function (res) {
	                    $("#showqrcode").attr("src", res.img);
	                    time = window.setInterval(isLogin, 3000);
	                }
	            });
	    	}

	    	var timeRun = 0;
	      //轮询判断是否登录
	        function isLogin() {
	                var url = "/wechat/islogin";
	                $.ajax({
	                    url: url,
	                    type: "get",
	                    async: true,
	                    success: function (resObj) {
// 	                        var resObj = JSON.parse(res);
	                        if (resObj.code == 200) {
	                            window.clearInterval(time);
/* 		        				$.cookie("openId",resObj.openId);
		        				$.cookie("nickName",resObj.nickName);
		        				$.cookie("headImg",resObj.headUrl);
		        				$.cookie("role",resObj.role); */
		        				window.openId = resObj.openId;
								window.nickName = resObj.nickName;
								window.headUrl = resObj.headUrl;
								window.role = resObj.role;
		        				console.log("openId inserted into cookie " + resObj.openId)

	                            if(resObj.bind==="false") {
									$("#showcode").css('display','none');
									// $("#showqrcode").css('display','none');
	                            	$("#alertbd").css('display','block');
	                            }else {
									window.location.href = "/";
								}
	                        } else if (resObj.code == 1) {
	                            window.clearInterval(time);
	                            console.log("获取微信用户信息失败")
	                        }else {
	                        	timeRun += 1;
	                        	if(timeRun >= 60) {
	                        		window.clearInterval(time);
	                        	}
	                        }
	                    }
	                });
	            }
	    	
			 $(document).ready(function () {
				 
					var url = "/wechat/getLoginInfo";
					window.openId = "";
					window.nickName = "";
					window.headUrl = "";
					window.role = "";
					window.bind = "";
				    $.ajax({
				        url: url,
				        type: "get",
				        async: false,
				        success: function (resObj) {
//				             var resObj = JSON.parse(res);
				            if (resObj.code == 200) {
								window.openId = resObj.openId;
								window.nickName = resObj.nickName;
								window.headUrl = resObj.headUrl;
								window.role = resObj.role;
								console.log("current openId " + resObj.openId)

				                if(resObj.bind==="false") {
									$("#showcode").css('display','none');
									// $("#showqrcode").css('display','none');
				                	$("#alertbd").css('display','block');
				                }
				            }
				        }
				    });
				 
				showLoginInfoFrontend();
				$("#loginBefore").click(function(){
					getQcode();
				});
				
				 $("#bindButtion").click(function(){
					if($("#bdaccount").val() == ""){
						alert('请输入用户名','提示')
						return;
					}
					if($("#bdpassword").val() == ""){
						alert('请输入密码','提示')
						return;
					}
					if($("#bdpassword2").val() == ""){
						alert('请确认密码','提示')
						return;
					}
					if($("#bdpassword").val() !== $("#bdpassword2").val()){
						alert('两次输入密码不一致','提示')
						return;
					}
					
					if($("#bdemail").val() == ""){
						alert('请输入电子邮箱','提示')
						return;
					}
					if(!$("#bdemail").val().match(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/)){
						alert('请输入有效邮箱','提示')
						return;
					}
					
					
					var formObject = {};
			        var formArray =$("#bindForm").serializeArray();
			        $.each(formArray,function(i,item){
			            formObject[item.name] = item.value;
			        });
			        formObject["nickName"] = window.nickName
			        formObject["openId"] = window.openId
			        $.ajax({
			            url:"user/bind",
			            type:"post",
			            contentType: "application/json; charset=utf-8",
			            data: JSON.stringify(formObject),
			            dataType: "json",
			            success:function(data){
			            	$("#alertbd").css('display','none'); 
			                if(data.code == "200")
			                {
			                	$("#logoinName").html(window.nickName);
			    			    $("#headImg").attr("src", window.headUrl);
								$("#loginBefore").css('display','none');
			    			    $("#loginAfter").css('display','block');
								window.location.href = "/";
			                }
			                else
			                {
			                	console.log("binding error" + data);
			                	if(data.code=="401") {
			                		alert(data.msg);
			                	}else {
			                	 $("#quit").click();
			                	}
			                	
			                }
			            },
			            error:function(e){
			                alert("错误！！");
			                $("#quit").click();
			            }
			        });
	
				});
				
				
				
// 				$(".alertInp").bind('input propertychange',function(){ 
// 					$('.erroText').css('display','none');
// 				});
			});
			$("#keywords").keypress(function(e) {
	            var eCode = e.keyCode ? e.keyCode : e.which ? e.which : e.charCode;
	             if (eCode == 13){
	                 search();
	             }
	     	});
			
			function search(){
			    /*  window.location.href="http://127.0.0.1:8088/project/list?q=" + $("#keywords").val(); */
			    window.location.href="/patent/list?q=" + $("#keywords").val();
				/* window.location.href="http://47.104.7.73/patent/list?q=" + $("#keywords").val(); */
			}
			function papersearch(){
			    /*  window.location.href="http://127.0.0.1:8088/project/list?q=" + $("#keywords").val(); */
			    window.location.href="/paper/list?q=" + $("#keywords").val();
				/* window.location.href="http://47.104.7.73/patent/list?q=" + $("#keywords").val(); */
			}
    </script>
	</body>
</html>
